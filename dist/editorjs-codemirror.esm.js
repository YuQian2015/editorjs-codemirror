import CM from"codemirror/lib/codemirror";import"codemirror/mode/javascript/javascript";import"codemirror/mode/css/css";import"codemirror/mode/xml/xml";import"codemirror/mode/htmlmixed/htmlmixed";import"codemirror/addon/edit/matchbrackets";import"codemirror/addon/edit/closetag";import"codemirror/keymap/sublime";import"codemirror/lib/codemirror.css";function ownKeys(t,e){var r,o=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,r)),o}function _objectSpread2(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=new Array(t);r<t;r++)o[r]=e[r];return o}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _createForOfIteratorHelper(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){r&&(e=r);function o(){}var a=0;return{s:o,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,i=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){c=!0,n=e},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw n}}}}function _classPrivateMethodGet(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}function _checkPrivateRedeclaration(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function _classPrivateMethodInitSpec(e,t){_checkPrivateRedeclaration(e,t),t.add(e)}var e=[],t=[];function n(r,o){var a,n,i,c;function s(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),o.attributes)for(var t=Object.keys(o.attributes),r=0;r<t.length;r++)e.setAttribute(t[r],o.attributes[t[r]]);return i.insertAdjacentElement("prepend"==a?"afterbegin":"beforeend",e),e}r&&"undefined"!=typeof document&&(a=!0===o.prepend?"prepend":"append",n=!0===o.singleTag,i="string"==typeof o.container?document.querySelector(o.container):document.getElementsByTagName("head")[0],c=n?(-1===(c=e.indexOf(i))&&(c=e.push(i)-1,t[c]={}),t[c]&&t[c][a]?t[c][a]:t[c][a]=s()):s(),65279===r.charCodeAt(0)&&(r=r.substring(1)),c.styleSheet?c.styleSheet.cssText+=r:c.appendChild(document.createTextNode(r)))}var css=".eft-codemirror .eft-codemirror__mode {\n  padding: 8px;\n  font-size: 14px;\n  outline: none;\n  border: solid 1px #E3E9ED;\n}\n.eft-codemirror .eft-codemirror__textarea {\n  width: 100%;\n}\n";function htmlEncodeByRegExp(e){return 0===e.length?"":e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/'/g,"&#39;").replace(/"/g,"&quot;")}function htmlDecodeByRegExp(e){return 0===e.length?"":e=e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/&#39;/g,"'").replace(/&quot;/g,'"').replace(/&amp;/g,"&")}n(css,{});var _make=new WeakSet,_initCodeMirror=new WeakSet,_changeLang=new WeakSet,CodeMirror=function(){function o(e){var t=e.data,r=e.api,e=e.config,e=void 0===e?{}:e;_classCallCheck(this,o),_classPrivateMethodInitSpec(this,_changeLang),_classPrivateMethodInitSpec(this,_initCodeMirror),_classPrivateMethodInitSpec(this,_make),this.api=r;r=e.languages,r=void 0===r?[]:r,e=e.codeMirrorConfig,e=void 0===e?{}:e;this.languages=[].concat(_toConsumableArray(this.defaultConfig.languages),_toConsumableArray(r)),this.codeMirrorConfig=_objectSpread2(_objectSpread2({},this.defaultConfig.codeMirrorConfig),e);e=htmlDecodeByRegExp(t.text||"");this.data={name:t.name||"javascript",text:e,mode:t.mode||"text/javascript"}}return _createClass(o,[{key:"CSS",get:function(){return{block:this.api.styles.block,input:this.api.styles.input,wrapper:"eft-codemirror",mode:"eft-codemirror__mode",textarea:"eft-codemirror__textarea"}}},{key:"defaultConfig",get:function(){return{languages:[{name:"Javascript",mode:"text/javascript"},{name:"HTML",mode:"text/html"},{name:"CSS",mode:"text/css"}],codeMirrorConfig:{lineNumbers:!0,matchBrackets:!0,autoCloseTags:!0,tabSize:2,keyMap:"sublime"}}}},{key:"render",value:function(){var r=this;this.wrapper=_classPrivateMethodGet(this,_make,_make2).call(this,"DIV",[this.CSS.block,this.CSS.wrapper],{});var e=_classPrivateMethodGet(this,_make,_make2).call(this,"TEXTAREA",[this.CSS.textarea],{});e.style.opacity=0,e.onfocus=function(){_classPrivateMethodGet(r,_initCodeMirror,_initCodeMirror2).call(r)};var t,o=_classPrivateMethodGet(this,_make,_make2).call(this,"SELECT",[this.CSS.mode,this.CSS.input],{}),a=_createForOfIteratorHelper(this.languages);try{for(a.s();!(t=a.n()).done;){var n=t.value,i=_classPrivateMethodGet(this,_make,_make2).call(this,"OPTION",[],{value:n.mode,selected:this.data.name===n.name});i.textContent=n.name,o.appendChild(i)}}catch(e){a.e(e)}finally{a.f()}return o.onchange=function(e){var t=r.languages[e.target.options.selectedIndex];r.data.name=t.name,_classPrivateMethodGet(r,_changeLang,_changeLang2).call(r,e.target.value)},this.textarea=e,this.wrapper.appendChild(e),this.wrapper.appendChild(o),this.wrapper.addEventListener("keyup",function(e){return e.stopPropagation(),e.preventDefault(),!1}),this.checkRender=setInterval(function(){_classPrivateMethodGet(r,_initCodeMirror,_initCodeMirror2).call(r),clearInterval(r.checkRender),r.checkRender=void 0},200),this.wrapper}},{key:"onPaste",value:function(e){e=e.detail.data;this.data={text:e.textContent,name:"javascript",mode:"text/javascript"}}},{key:"save",value:function(){var e={};return this.codeEditor&&(e.mode=this.codeEditor.doc.cm.getOption("mode"),e.text=htmlEncodeByRegExp(this.codeEditor.doc.getValue()||"")),Object.assign(this.data,e)}}],[{key:"enableLineBreaks",get:function(){return!0}},{key:"toolbox",get:function(){return{title:"CodeMirror",icon:'<svg t="1579056838304" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1481" width="32" height="32"><path d="M458.1197853 689.75976308l-156.42642974-156.42642975 156.42642974-156.42642975-47.50728606-47.50728607L206.67878342 533.33333333l203.93371582 203.93371583 47.50728606-47.50728609z m107.7604294-1e-8l156.42642974-156.42642974-156.42642974-156.42642975 47.50728606-47.50728607L817.32121658 533.33333333 613.38750076 737.26704916 565.8802147 689.75976308z" p-id="1482"></path></svg>'}}},{key:"pasteConfig",get:function(){return{tags:["pre"]}}}]),o}();function _make2(e){var t,r,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},n=document.createElement(e);for(r in Array.isArray(o)?(t=n.classList).add.apply(t,_toConsumableArray(o)):o&&n.classList.add(o),a)n[r]=a[r];return n}function _initCodeMirror2(){this.codeEditor||(this.textarea.value=this.data.text,this.codeEditor=CM.fromTextArea(this.textarea,_objectSpread2(_objectSpread2({},this.codeMirrorConfig),{},{mode:this.data.mode})),this.codeEditor.on("blur",function(){}))}function _changeLang2(e){this.codeEditor&&this.codeEditor.setOption("mode",e)}export{CodeMirror as default};
